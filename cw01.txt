
CREATE TABLE REGIONS (
    REGION_ID INT PRIMARY KEY,
    REGION_NAME VARCHAR(50)
);


CREATE TABLE COUNTRIES (
    COUNTRY_ID INT PRIMARY KEY,
    COUNTRY_NAME VARCHAR(40)
);


CREATE TABLE LOCATIONS (
    LOCATION_ID INT PRIMARY KEY,
    STREET_ADDRESS VARCHAR(40),
    POSTAL_CODE VARCHAR(12),
    CITY VARCHAR(30),
    STATE_PROVINCE VARCHAR(25)
);


CREATE TABLE JOBS (
    JOB_ID INT PRIMARY KEY,
    JOB_TITLE VARCHAR(35) NOT NULL,
    MIN_SALARY DECIMAL(8, 2),
    MAX_SALARY DECIMAL(8, 2)
);

CREATE TABLE DEPARTMENTS (
    DEPARTMENT_ID INT PRIMARY KEY,
    DEPARTMENT_NAME VARCHAR(30) NOT NULL,
    MANAGER_ID INT
);


CREATE TABLE EMPLOYEES (
    EMPLOYEE_ID INT PRIMARY KEY,
    FIRST_NAME VARCHAR(20),
    LAST_NAME VARCHAR(25) NOT NULL,
    EMAIL VARCHAR(25) NOT NULL UNIQUE,
    PHONE_NUMBER VARCHAR(20),
    HIRE_DATE DATE NOT NULL,
    JOB_ID INT NOT NULL,
    SALARY DECIMAL(8, 2),
    COMMISSION_PCT DECIMAL(2, 2),
    MANAGER_ID INT,
    DEPARTMENT_ID INT
);

CREATE TABLE JOB_HISTORY (
    EMPLOYEE_ID INT,
    START_DATE DATE,
    END_DATE DATE,
    JOB_ID INT,
    DEPARTMENT_ID INT,
    PRIMARY KEY (EMPLOYEE_ID, START_DATE)
);


ALTER TABLE COUNTRIES ADD REGION_ID INT;
ALTER TABLE COUNTRIES ADD CONSTRAINT FK_COUNTR_REG FOREIGN KEY (REGION_ID) REFERENCES REGIONS(REGION_ID);

ALTER TABLE LOCATIONS ADD COUNTRY_ID CHAR(2);
ALTER TABLE LOCATIONS ADD CONSTRAINT FK_LOC_COUNTR FOREIGN KEY (COUNTRY_ID) REFERENCES COUNTRIES(COUNTRY_ID);


ALTER TABLE DEPARTMENTS ADD LOCATION_ID INT;
ALTER TABLE DEPARTMENTS ADD CONSTRAINT FK_DEPT_LOC FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS(LOCATION_ID);
ALTER TABLE DEPARTMENTS ADD CONSTRAINT FK_DEPT_MGR FOREIGN KEY (MANAGER_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID); 


ALTER TABLE EMPLOYEES ADD CONSTRAINT FK_EMP_DEPT FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS(DEPARTMENT_ID);
ALTER TABLE EMPLOYEES ADD CONSTRAINT FK_EMP_JOB FOREIGN KEY (JOB_ID) REFERENCES JOBS(JOB_ID);
ALTER TABLE EMPLOYEES ADD CONSTRAINT FK_EMP_MGR FOREIGN KEY (MANAGER_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID);

ALTER TABLE JOB_HISTORY ADD CONSTRAINT FK_JH_EMP FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID);
ALTER TABLE JOB_HISTORY ADD CONSTRAINT FK_JH_JOB FOREIGN KEY (JOB_ID) REFERENCES JOBS(JOB_ID);
ALTER TABLE JOB_HISTORY ADD CONSTRAINT FK_JH_DEPT FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS(DEPARTMENT_ID);

ALTER TABLE JOBS ADD CONSTRAINT CHK_SALARY CHECK (MAX_SALARY >= MIN_SALARY + 2000);

DROP TABLE REGIONS CASCADE CONSTRAINTS;

FLASHBACK TABLE REGIONS TO BEFORE DROP;